# ESP32 Arduino 고급 커리큘럼 (45일)

**대상:** 중급 과정 수료자
**목표:** PC-스마트폰-ESP32 연동 및 DB 기반 IoT 시스템 구축
**선수 과목:** ESP32 Arduino 초급(15일) + 중급(30일)

---

## Part 1: PC 서버 기초 (Day 1-10)

### Day 1: Node.js 소개와 설치
**학습 목표:** PC에서 서버 환경 구축

| 항목 | 내용 |
|------|------|
| 이론 | Node.js 개념, npm, 패키지 관리 |
| 실습 | Node.js 설치, 첫 서버 실행 |
| 과제 | "Hello World" 서버 만들기 |

```javascript
// server.js
const http = require('http');

const server = http.createServer((req, res) => {
    res.writeHead(200, {'Content-Type': 'text/html; charset=utf-8'});
    res.end('<h1>Hello from Node.js!</h1>');
});

server.listen(3000, () => {
    console.log('서버 시작: http://localhost:3000');
});
```

---

### Day 2: Express.js 웹 프레임워크
**학습 목표:** Express로 웹 서버 구축

| 항목 | 내용 |
|------|------|
| 이론 | Express 라우팅, 미들웨어 |
| 실습 | REST API 서버 구축 |
| 과제 | CRUD API 만들기 |

```javascript
const express = require('express');
const app = express();

app.use(express.json());

app.get('/api/status', (req, res) => {
    res.json({ status: 'running', uptime: process.uptime() });
});

app.post('/api/sensor', (req, res) => {
    const { temperature, humidity } = req.body;
    console.log(`온도: ${temperature}, 습도: ${humidity}`);
    res.json({ success: true });
});

app.listen(3000);
```

---

### Day 3: SQLite 데이터베이스 기초
**학습 목표:** 로컬 데이터베이스 사용

| 항목 | 내용 |
|------|------|
| 이론 | SQL 기초, CRUD 쿼리 |
| 실습 | SQLite 설치, 테이블 생성 |
| 과제 | 센서 데이터 저장 테이블 설계 |

```javascript
const sqlite3 = require('sqlite3').verbose();
const db = new sqlite3.Database('./sensor_data.db');

// 테이블 생성
db.run(`
    CREATE TABLE IF NOT EXISTS sensor_log (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        device_id TEXT,
        temperature REAL,
        humidity REAL,
        timestamp DATETIME DEFAULT CURRENT_TIMESTAMP
    )
`);

// 데이터 삽입
function insertSensorData(deviceId, temp, humid) {
    db.run(
        'INSERT INTO sensor_log (device_id, temperature, humidity) VALUES (?, ?, ?)',
        [deviceId, temp, humid]
    );
}
```

---

### Day 4: 데이터 조회와 API 연동
**학습 목표:** DB 데이터를 API로 제공

| 항목 | 내용 |
|------|------|
| 이론 | SELECT 쿼리, 데이터 필터링 |
| 실습 | 최근 데이터, 기간별 데이터 조회 |
| 과제 | 통계 API (평균, 최대, 최소) |

```javascript
// 최근 100개 데이터 조회
app.get('/api/sensor/recent', (req, res) => {
    db.all(
        'SELECT * FROM sensor_log ORDER BY timestamp DESC LIMIT 100',
        (err, rows) => {
            res.json(rows);
        }
    );
});

// 기간별 조회
app.get('/api/sensor/range', (req, res) => {
    const { start, end } = req.query;
    db.all(
        'SELECT * FROM sensor_log WHERE timestamp BETWEEN ? AND ?',
        [start, end],
        (err, rows) => res.json(rows)
    );
});

// 통계
app.get('/api/sensor/stats', (req, res) => {
    db.get(
        `SELECT
            AVG(temperature) as avg_temp,
            MAX(temperature) as max_temp,
            MIN(temperature) as min_temp,
            AVG(humidity) as avg_humid
         FROM sensor_log
         WHERE timestamp > datetime('now', '-24 hours')`,
        (err, row) => res.json(row)
    );
});
```

---

### Day 5: 웹 대시보드 UI (Chart.js)
**학습 목표:** PC에서 데이터 시각화

| 항목 | 내용 |
|------|------|
| 이론 | Chart.js 라이브러리 |
| 실습 | 실시간 그래프, 파이 차트 |
| 과제 | 24시간 온습도 그래프 |

```html
<!DOCTYPE html>
<html>
<head>
    <title>ESP32 모니터링 대시보드</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <h1>센서 모니터링</h1>
    <canvas id="tempChart" width="800" height="400"></canvas>

    <script>
        const ctx = document.getElementById('tempChart');
        const chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: [],
                datasets: [
                    { label: '온도 (°C)', data: [], borderColor: 'red' },
                    { label: '습도 (%)', data: [], borderColor: 'blue' }
                ]
            },
            options: {
                scales: {
                    y: { beginAtZero: false }
                }
            }
        });

        async function fetchData() {
            const res = await fetch('/api/sensor/recent?limit=50');
            const data = await res.json();

            chart.data.labels = data.map(d => new Date(d.timestamp).toLocaleTimeString());
            chart.data.datasets[0].data = data.map(d => d.temperature);
            chart.data.datasets[1].data = data.map(d => d.humidity);
            chart.update();
        }

        fetchData();
        setInterval(fetchData, 5000);
    </script>
</body>
</html>
```

---

### Day 6: WebSocket 서버 (Socket.io)
**학습 목표:** 실시간 양방향 통신

| 항목 | 내용 |
|------|------|
| 이론 | Socket.io, 이벤트 기반 통신 |
| 실습 | 실시간 데이터 브로드캐스트 |
| 과제 | 연결된 클라이언트 관리 |

```javascript
const { Server } = require('socket.io');
const io = new Server(server);

// 연결된 클라이언트 관리
const clients = new Map();

io.on('connection', (socket) => {
    console.log('클라이언트 연결:', socket.id);

    socket.on('register', (deviceId) => {
        clients.set(socket.id, deviceId);
        io.emit('device_list', Array.from(clients.values()));
    });

    socket.on('sensor_data', (data) => {
        // DB에 저장
        insertSensorData(data.deviceId, data.temperature, data.humidity);
        // 모든 클라이언트에 브로드캐스트
        io.emit('new_data', data);
    });

    socket.on('disconnect', () => {
        clients.delete(socket.id);
        io.emit('device_list', Array.from(clients.values()));
    });
});
```

---

### Day 7: ESP32와 PC 서버 연동
**학습 목표:** ESP32 데이터를 PC 서버로 전송

| 항목 | 내용 |
|------|------|
| 이론 | HTTP POST, JSON 전송 |
| 실습 | 센서 데이터 주기적 전송 |
| 과제 | 전송 실패시 재시도 로직 |

```cpp
#include <HTTPClient.h>
#include <ArduinoJson.h>

const char* serverUrl = "http://192.168.1.100:3000/api/sensor";

void sendDataToServer(float temp, float humid) {
    HTTPClient http;
    http.begin(serverUrl);
    http.addHeader("Content-Type", "application/json");

    StaticJsonDocument<200> doc;
    doc["deviceId"] = "ESP32-001";
    doc["temperature"] = temp;
    doc["humidity"] = humid;

    String json;
    serializeJson(doc, json);

    int httpCode = http.POST(json);

    if (httpCode > 0) {
        Serial.println("전송 성공: " + http.getString());
    } else {
        Serial.println("전송 실패: " + String(httpCode));
    }

    http.end();
}
```

---

### Day 8: ESP32 Socket.io 클라이언트
**학습 목표:** ESP32에서 실시간 통신

| 항목 | 내용 |
|------|------|
| 이론 | WebSocket 클라이언트 |
| 실습 | Socket.io 연결 및 이벤트 |
| 과제 | PC에서 ESP32 제어 명령 수신 |

```cpp
#include <SocketIOclient.h>

SocketIOclient socketIO;

void socketIOEvent(socketIOmessageType_t type, uint8_t* payload, size_t length) {
    switch(type) {
        case sIOtype_CONNECT:
            Serial.println("Socket.io 연결됨");
            // 디바이스 등록
            socketIO.sendEVENT("[\"register\",\"ESP32-001\"]");
            break;

        case sIOtype_EVENT:
            handleEvent(payload, length);
            break;

        case sIOtype_DISCONNECT:
            Serial.println("연결 해제됨");
            break;
    }
}

void setup() {
    // Wi-Fi 연결 후...
    socketIO.begin("192.168.1.100", 3000, "/socket.io/?EIO=4");
    socketIO.onEvent(socketIOEvent);
}

void loop() {
    socketIO.loop();

    // 주기적으로 센서 데이터 전송
    static unsigned long lastSend = 0;
    if (millis() - lastSend > 5000) {
        lastSend = millis();
        sendSensorData();
    }
}

void sendSensorData() {
    String json = "[\"sensor_data\",{\"deviceId\":\"ESP32-001\",";
    json += "\"temperature\":" + String(temperature) + ",";
    json += "\"humidity\":" + String(humidity) + "}]";
    socketIO.sendEVENT(json);
}
```

---

### Day 9: PC에서 ESP32 제어
**학습 목표:** PC 대시보드에서 하드웨어 제어

| 항목 | 내용 |
|------|------|
| 이론 | 양방향 명령 전달 |
| 실습 | LED ON/OFF 명령 전송 |
| 과제 | 부저, 알림 설정 등 다양한 명령 |

**PC 서버 (Node.js):**
```javascript
// 제어 명령 전달
app.post('/api/control', (req, res) => {
    const { deviceId, command, params } = req.body;

    // 해당 디바이스에 명령 전송
    io.emit('control_command', { deviceId, command, params });

    res.json({ success: true });
});
```

**ESP32:**
```cpp
void handleEvent(uint8_t* payload, size_t length) {
    String msg = String((char*)payload);

    if (msg.indexOf("control_command") >= 0) {
        // JSON 파싱
        StaticJsonDocument<200> doc;
        // ... 파싱 로직

        String command = doc["command"];

        if (command == "led_on") {
            int pin = doc["params"]["pin"];
            digitalWrite(pin, HIGH);
        } else if (command == "led_off") {
            int pin = doc["params"]["pin"];
            digitalWrite(pin, LOW);
        } else if (command == "buzzer") {
            int freq = doc["params"]["frequency"];
            int duration = doc["params"]["duration"];
            tone(BUZZER_MELODY, freq, duration);
        }
    }
}
```

---

### Day 10: 종합 실습 - PC-ESP32 연동 시스템
**학습 목표:** Part 1 통합 프로젝트

| 항목 | 내용 |
|------|------|
| 프로젝트 | 센서 모니터링 + 원격 제어 |
| 기능 | DB 저장, 그래프 표시, 하드웨어 제어 |

---

## Part 2: 스마트폰-PC 연동 (Day 11-20)

### Day 11: 모바일 웹 앱 최적화
**학습 목표:** PC 대시보드의 모바일 버전

| 항목 | 내용 |
|------|------|
| 이론 | PWA, 반응형 디자인 |
| 실습 | 모바일 최적화 대시보드 |
| 과제 | 홈 화면 추가 기능 |

```html
<!-- manifest.json -->
{
    "name": "ESP32 Monitor",
    "short_name": "ESP32",
    "start_url": "/",
    "display": "standalone",
    "background_color": "#ffffff",
    "theme_color": "#3498db",
    "icons": [
        { "src": "/icon-192.png", "sizes": "192x192", "type": "image/png" }
    ]
}

<!-- index.html -->
<link rel="manifest" href="/manifest.json">
<meta name="apple-mobile-web-app-capable" content="yes">
```

---

### Day 12: 사용자 인증 시스템
**학습 목표:** 로그인/회원가입 구현

| 항목 | 내용 |
|------|------|
| 이론 | JWT, 세션, bcrypt |
| 실습 | 회원가입, 로그인 API |
| 과제 | 비밀번호 변경, 프로필 관리 |

```javascript
const jwt = require('jsonwebtoken');
const bcrypt = require('bcrypt');

// 회원가입
app.post('/api/register', async (req, res) => {
    const { email, password, name } = req.body;
    const hashedPassword = await bcrypt.hash(password, 10);

    db.run(
        'INSERT INTO users (email, password, name) VALUES (?, ?, ?)',
        [email, hashedPassword, name],
        (err) => {
            if (err) return res.status(400).json({ error: '이미 존재하는 이메일' });
            res.json({ success: true });
        }
    );
});

// 로그인
app.post('/api/login', (req, res) => {
    const { email, password } = req.body;

    db.get('SELECT * FROM users WHERE email = ?', [email], async (err, user) => {
        if (!user || !await bcrypt.compare(password, user.password)) {
            return res.status(401).json({ error: '인증 실패' });
        }

        const token = jwt.sign({ userId: user.id }, 'secret_key', { expiresIn: '24h' });
        res.json({ token, user: { id: user.id, name: user.name, email: user.email } });
    });
});
```

---

### Day 13: 디바이스 등록 및 관리
**학습 목표:** 사용자별 ESP32 디바이스 관리

| 항목 | 내용 |
|------|------|
| 이론 | 디바이스 인증, 토큰 관리 |
| 실습 | 디바이스 등록 페이지 |
| 과제 | 디바이스 별칭 설정, 삭제 |

```javascript
// 디바이스 등록
app.post('/api/devices', authMiddleware, (req, res) => {
    const { deviceId, name, location } = req.body;
    const userId = req.user.userId;

    db.run(
        'INSERT INTO devices (device_id, user_id, name, location) VALUES (?, ?, ?, ?)',
        [deviceId, userId, name, location],
        (err) => {
            if (err) return res.status(400).json({ error: '등록 실패' });
            res.json({ success: true });
        }
    );
});

// 내 디바이스 목록
app.get('/api/devices', authMiddleware, (req, res) => {
    db.all(
        'SELECT * FROM devices WHERE user_id = ?',
        [req.user.userId],
        (err, rows) => res.json(rows)
    );
});
```

---

### Day 14: 푸시 알림 (Web Push)
**학습 목표:** 스마트폰으로 푸시 알림

| 항목 | 내용 |
|------|------|
| 이론 | Service Worker, Web Push API |
| 실습 | 온도 경고 푸시 알림 |
| 과제 | 사용자 지정 알림 조건 |

```javascript
// 서버 - web-push
const webpush = require('web-push');

webpush.setVapidDetails(
    'mailto:admin@example.com',
    'PUBLIC_VAPID_KEY',
    'PRIVATE_VAPID_KEY'
);

function sendPushNotification(subscription, title, body) {
    webpush.sendNotification(subscription, JSON.stringify({ title, body }));
}

// 온도 체크 및 알림
function checkTemperatureAlert(deviceId, temp) {
    if (temp > 30) {
        db.all(
            'SELECT push_subscription FROM users u JOIN devices d ON u.id = d.user_id WHERE d.device_id = ?',
            [deviceId],
            (err, rows) => {
                rows.forEach(row => {
                    const subscription = JSON.parse(row.push_subscription);
                    sendPushNotification(subscription, '온도 경고!', `현재 온도: ${temp}°C`);
                });
            }
        );
    }
}
```

---

### Day 15: 알림 규칙 설정
**학습 목표:** 사용자 맞춤 알림 조건

| 항목 | 내용 |
|------|------|
| 이론 | 조건식, 규칙 엔진 |
| 실습 | 알림 규칙 CRUD |
| 과제 | 복합 조건 알림 (AND/OR) |

```javascript
// 알림 규칙 테이블
/*
CREATE TABLE alert_rules (
    id INTEGER PRIMARY KEY,
    user_id INTEGER,
    device_id TEXT,
    sensor_type TEXT,      -- 'temperature', 'humidity'
    condition TEXT,        -- 'gt', 'lt', 'eq'
    threshold REAL,
    message TEXT,
    enabled INTEGER DEFAULT 1
);
*/

// 규칙 체크
function checkAlertRules(deviceId, sensorData) {
    db.all(
        'SELECT * FROM alert_rules WHERE device_id = ? AND enabled = 1',
        [deviceId],
        (err, rules) => {
            rules.forEach(rule => {
                const value = sensorData[rule.sensor_type];
                let triggered = false;

                switch (rule.condition) {
                    case 'gt': triggered = value > rule.threshold; break;
                    case 'lt': triggered = value < rule.threshold; break;
                    case 'eq': triggered = value == rule.threshold; break;
                }

                if (triggered) {
                    sendAlertNotification(rule);
                }
            });
        }
    );
}
```

---

### Day 16-17: 데이터 내보내기/가져오기
**학습 목표:** CSV/Excel 내보내기

| 항목 | 내용 |
|------|------|
| 이론 | 파일 생성, 다운로드 |
| 실습 | CSV 내보내기 |
| 과제 | 기간 선택, Excel 형식 |

```javascript
const createCsvWriter = require('csv-writer').createObjectCsvWriter;

app.get('/api/export/csv', authMiddleware, async (req, res) => {
    const { deviceId, startDate, endDate } = req.query;

    db.all(
        `SELECT * FROM sensor_log
         WHERE device_id = ? AND timestamp BETWEEN ? AND ?`,
        [deviceId, startDate, endDate],
        (err, rows) => {
            const filename = `sensor_data_${Date.now()}.csv`;
            const csvWriter = createCsvWriter({
                path: `./exports/${filename}`,
                header: [
                    { id: 'timestamp', title: '시간' },
                    { id: 'temperature', title: '온도' },
                    { id: 'humidity', title: '습도' }
                ]
            });

            csvWriter.writeRecords(rows).then(() => {
                res.download(`./exports/${filename}`);
            });
        }
    );
});
```

---

### Day 18-20: 스마트폰 통합 앱 프로젝트
**학습 목표:** 종합 모바일 앱 제작

| 항목 | 내용 |
|------|------|
| Day 18 | 앱 설계 및 UI 구현 |
| Day 19 | 기능 통합 및 테스트 |
| Day 20 | 발표 및 피드백 |

**기능:**
- 로그인/회원가입
- 디바이스 관리
- 실시간 모니터링
- 원격 제어
- 알림 설정
- 데이터 내보내기

---

## Part 3: 고급 데이터베이스 (Day 21-30)

### Day 21: MySQL/MariaDB 설치
**학습 목표:** 관계형 데이터베이스

| 항목 | 내용 |
|------|------|
| 이론 | RDBMS, MySQL 기초 |
| 실습 | MySQL 설치, 사용자 생성 |
| 과제 | 센서 데이터베이스 설계 |

```sql
-- 데이터베이스 생성
CREATE DATABASE esp32_iot;

-- 테이블 설계
CREATE TABLE users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    email VARCHAR(255) UNIQUE NOT NULL,
    password VARCHAR(255) NOT NULL,
    name VARCHAR(100),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE devices (
    id INT AUTO_INCREMENT PRIMARY KEY,
    device_id VARCHAR(50) UNIQUE NOT NULL,
    user_id INT,
    name VARCHAR(100),
    location VARCHAR(255),
    last_seen TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id)
);

CREATE TABLE sensor_logs (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    device_id VARCHAR(50),
    temperature DECIMAL(5,2),
    humidity DECIMAL(5,2),
    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_device_time (device_id, timestamp)
);
```

---

### Day 22: 데이터 집계와 분석
**학습 목표:** SQL 고급 쿼리

| 항목 | 내용 |
|------|------|
| 이론 | GROUP BY, 집계 함수, 서브쿼리 |
| 실습 | 시간대별, 일별 통계 |
| 과제 | 월간 리포트 생성 |

```sql
-- 시간대별 평균
SELECT
    DATE_FORMAT(timestamp, '%Y-%m-%d %H:00') as hour,
    AVG(temperature) as avg_temp,
    AVG(humidity) as avg_humid,
    MAX(temperature) as max_temp,
    MIN(temperature) as min_temp
FROM sensor_logs
WHERE device_id = 'ESP32-001'
  AND timestamp > DATE_SUB(NOW(), INTERVAL 24 HOUR)
GROUP BY hour
ORDER BY hour;

-- 일별 통계
SELECT
    DATE(timestamp) as date,
    AVG(temperature) as avg_temp,
    MAX(temperature) as max_temp,
    MIN(temperature) as min_temp,
    COUNT(*) as readings
FROM sensor_logs
WHERE device_id = 'ESP32-001'
  AND timestamp > DATE_SUB(NOW(), INTERVAL 30 DAY)
GROUP BY date
ORDER BY date;
```

---

### Day 23: 데이터 보관 정책
**학습 목표:** 오래된 데이터 관리

| 항목 | 내용 |
|------|------|
| 이론 | 데이터 아카이빙, 파티셔닝 |
| 실습 | 자동 데이터 정리 스크립트 |
| 과제 | 요약 테이블 생성 |

```sql
-- 요약 테이블 (시간별)
CREATE TABLE sensor_hourly_summary (
    id INT AUTO_INCREMENT PRIMARY KEY,
    device_id VARCHAR(50),
    hour DATETIME,
    avg_temp DECIMAL(5,2),
    max_temp DECIMAL(5,2),
    min_temp DECIMAL(5,2),
    avg_humid DECIMAL(5,2),
    readings INT,
    UNIQUE KEY (device_id, hour)
);

-- 요약 데이터 생성 프로시저
DELIMITER //
CREATE PROCEDURE summarize_hourly()
BEGIN
    INSERT INTO sensor_hourly_summary
        (device_id, hour, avg_temp, max_temp, min_temp, avg_humid, readings)
    SELECT
        device_id,
        DATE_FORMAT(timestamp, '%Y-%m-%d %H:00:00'),
        AVG(temperature),
        MAX(temperature),
        MIN(temperature),
        AVG(humidity),
        COUNT(*)
    FROM sensor_logs
    WHERE timestamp < DATE_SUB(NOW(), INTERVAL 1 HOUR)
      AND timestamp > DATE_SUB(NOW(), INTERVAL 2 HOUR)
    GROUP BY device_id, DATE_FORMAT(timestamp, '%Y-%m-%d %H:00:00')
    ON DUPLICATE KEY UPDATE
        avg_temp = VALUES(avg_temp),
        max_temp = VALUES(max_temp),
        min_temp = VALUES(min_temp);

    -- 원본 데이터 삭제 (7일 이상)
    DELETE FROM sensor_logs
    WHERE timestamp < DATE_SUB(NOW(), INTERVAL 7 DAY);
END //
DELIMITER ;
```

---

### Day 24-25: 이벤트 로깅 시스템
**학습 목표:** 모든 이벤트 기록

| 항목 | 내용 |
|------|------|
| 이론 | 이벤트 소싱, 감사 로그 |
| 실습 | 이벤트 테이블 설계 |
| 과제 | 이벤트 검색 및 필터링 |

```sql
CREATE TABLE event_logs (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    device_id VARCHAR(50),
    event_type VARCHAR(50),  -- 'sensor_read', 'led_control', 'alert', 'connection'
    event_data JSON,
    user_id INT,
    ip_address VARCHAR(45),
    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_device_event (device_id, event_type, timestamp)
);
```

```javascript
// 이벤트 기록 함수
function logEvent(deviceId, eventType, eventData, userId = null) {
    db.query(
        'INSERT INTO event_logs (device_id, event_type, event_data, user_id) VALUES (?, ?, ?, ?)',
        [deviceId, eventType, JSON.stringify(eventData), userId]
    );
}

// 사용 예시
logEvent('ESP32-001', 'led_control', { pin: 25, state: 'on' }, req.user.id);
logEvent('ESP32-001', 'alert', { type: 'temperature', value: 35, threshold: 30 });
```

---

### Day 26-27: 대시보드 고급 기능
**학습 목표:** 데이터 시각화 고급

| 항목 | 내용 |
|------|------|
| 이론 | 히트맵, 게이지, 실시간 갱신 |
| 실습 | 고급 차트 구현 |
| 과제 | 커스텀 대시보드 |

---

### Day 28-30: 종합 프로젝트 - IoT 모니터링 플랫폼
**학습 목표:** Part 3 통합 프로젝트

| 항목 | 내용 |
|------|------|
| Day 28 | 시스템 설계 및 DB 구축 |
| Day 29 | 백엔드 API 구현 |
| Day 30 | 프론트엔드 및 통합 테스트 |

---

## Part 4: LoRa 통신 (Day 31-38)

### Day 31: LoRa 모듈 소개
**학습 목표:** LoRa 통신 이해

| 항목 | 내용 |
|------|------|
| 이론 | LoRa 특징, 장거리 저전력 통신 |
| 실습 | LoRa 모듈 연결 및 설정 |
| 사용 핀 | TXD(17), RXD(16), M0(15), M1(4), AUX(34) |

```cpp
#define LORA_TXD  17
#define LORA_RXD  16
#define LORA_M0   15
#define LORA_M1   4
#define LORA_AUX  34

void setupLoRa() {
    Serial2.begin(9600, SERIAL_8N1, LORA_RXD, LORA_TXD);

    pinMode(LORA_M0, OUTPUT);
    pinMode(LORA_M1, OUTPUT);
    pinMode(LORA_AUX, INPUT);

    // 일반 모드 설정
    digitalWrite(LORA_M0, LOW);
    digitalWrite(LORA_M1, LOW);
}
```

---

### Day 32: LoRa 1:1 통신
**학습 목표:** 두 ESP32간 데이터 전송

| 항목 | 내용 |
|------|------|
| 이론 | 송신/수신 프로토콜 |
| 실습 | 센서 데이터 원거리 전송 |
| 과제 | 양방향 통신 구현 |

```cpp
// 송신측
void sendLoRaData(float temp, float humid) {
    String data = "T:" + String(temp) + ",H:" + String(humid);
    Serial2.println(data);
    Serial.println("LoRa 전송: " + data);
}

// 수신측
void receiveLoRaData() {
    if (Serial2.available()) {
        String data = Serial2.readStringUntil('\n');
        Serial.println("LoRa 수신: " + data);

        // 파싱
        int tIdx = data.indexOf("T:");
        int hIdx = data.indexOf(",H:");
        float temp = data.substring(tIdx + 2, hIdx).toFloat();
        float humid = data.substring(hIdx + 3).toFloat();

        // 처리
        processReceivedData(temp, humid);
    }
}
```

---

### Day 33-34: LoRa 메시 네트워크
**학습 목표:** 여러 노드 간 통신

| 항목 | 내용 |
|------|------|
| 이론 | 주소 지정, 라우팅 |
| 실습 | 3개 이상 노드 네트워크 |
| 과제 | 중계 노드 구현 |

---

### Day 35-36: LoRa 게이트웨이
**학습 목표:** LoRa 데이터를 인터넷으로

| 항목 | 내용 |
|------|------|
| 이론 | 게이트웨이 역할 |
| 실습 | LoRa → Wi-Fi → 서버 전송 |
| 과제 | 다중 노드 데이터 수집 |

```cpp
// 게이트웨이 (LoRa + Wi-Fi)
void loop() {
    // LoRa 데이터 수신
    if (Serial2.available()) {
        String loraData = Serial2.readStringUntil('\n');
        Serial.println("LoRa 수신: " + loraData);

        // 서버로 전송
        sendToServer(loraData);
    }

    server.handleClient();
}

void sendToServer(String data) {
    HTTPClient http;
    http.begin(serverUrl);
    http.addHeader("Content-Type", "application/json");

    String json = "{\"source\":\"lora\",\"data\":\"" + data + "\"}";
    http.POST(json);
    http.end();
}
```

---

### Day 37-38: LoRa 프로젝트
**학습 목표:** 원격 센서 네트워크

| 항목 | 내용 |
|------|------|
| Day 37 | 시스템 설계 및 구현 |
| Day 38 | 테스트 및 발표 |

**프로젝트 구성:**
- 센서 노드 (LoRa 송신) × 2~3개
- 게이트웨이 (LoRa 수신 + Wi-Fi)
- PC 서버 (데이터 저장 및 표시)

---

## Part 5: 최종 프로젝트 (Day 39-45)

### Day 39-40: 프로젝트 기획
**학습 목표:** 종합 IoT 시스템 설계

| 항목 | 내용 |
|------|------|
| 활동 | 요구사항 분석, 시스템 설계 |
| 산출물 | 기능 명세서, 아키텍처 다이어그램 |

### Day 41-42: 백엔드 개발
**학습 목표:** 서버 및 데이터베이스 구현

### Day 43: 프론트엔드 개발
**학습 목표:** PC/모바일 UI 구현

### Day 44: 통합 및 테스트
**학습 목표:** 전체 시스템 통합

### Day 45: 발표 및 수료
**학습 목표:** 프로젝트 발표

---

## 최종 프로젝트: 스마트 환경 모니터링 시스템

### 시스템 구성
```
[센서 노드] --LoRa--> [게이트웨이] --Wi-Fi--> [PC 서버] <--Web--> [스마트폰/PC]
   ESP32                ESP32               Node.js+MySQL        브라우저
```

### 기능 목록
1. **다중 센서 노드**
   - 온습도 측정
   - LoRa로 데이터 전송
   - 저전력 모드

2. **게이트웨이**
   - LoRa 데이터 수집
   - Wi-Fi로 서버 전송
   - 로컬 OLED 표시

3. **PC 서버**
   - 사용자 인증
   - 데이터베이스 저장
   - REST API
   - WebSocket 실시간 통신

4. **웹 대시보드**
   - 실시간 모니터링
   - 그래프 및 통계
   - 원격 제어
   - 알림 설정

5. **스마트폰 앱**
   - 푸시 알림
   - 원격 제어
   - 데이터 조회

---

## 핀 사용 요약 (고급)

| 기능 | GPIO | Part |
|------|------|------|
| LED_RED | 25 | 전체 |
| LED_YELLOW | 26 | 전체 |
| LED_BLUE | 27 | 전체 |
| BUZZER_BEEP | 14 | 전체 |
| BUZZER_MELODY | 33 | 전체 |
| SWITCH | 32 | 전체 |
| I2C_SDA | 21 | 전체 |
| I2C_SCL | 22 | 전체 |
| LORA_TXD | 17 | Part 4 |
| LORA_RXD | 16 | Part 4 |
| LORA_M0 | 15 | Part 4 |
| LORA_M1 | 4 | Part 4 |
| LORA_AUX | 34 | Part 4 |

---

## 준비물

- ESP32 교육보드 × 2~3개 (LoRa 실습용)
- PC (Node.js, MySQL 설치)
- 스마트폰
- USB 케이블
- Wi-Fi 공유기
