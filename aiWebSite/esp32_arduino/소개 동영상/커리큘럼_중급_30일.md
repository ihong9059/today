# ESP32 Arduino 중급 커리큘럼 (30일)

**대상:** 초급 과정 수료자
**목표:** HTML/Wi-Fi를 활용한 스마트폰 연동 및 하드웨어 제어
**선수 과목:** ESP32 Arduino 초급 (15일)

---

## Part 1: HTML/CSS 심화 (Day 1-5)

### Day 1: 반응형 웹 디자인
**학습 목표:** 모바일/PC 모두 대응하는 웹 페이지

| 항목 | 내용 |
|------|------|
| 이론 | viewport, media query, flexbox |
| 실습 | 반응형 레이아웃 구현 |
| 과제 | 모바일 최적화 대시보드 |

```html
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
    .container { display: flex; flex-wrap: wrap; }
    .card { flex: 1 1 300px; margin: 10px; }
    @media (max-width: 600px) {
        .card { flex: 1 1 100%; }
    }
</style>
```

---

### Day 2: CSS 애니메이션과 효과
**학습 목표:** 시각적으로 풍부한 UI 제작

| 항목 | 내용 |
|------|------|
| 이론 | transition, animation, keyframes |
| 실습 | 버튼 호버 효과, 로딩 스피너 |
| 과제 | 센서 값에 따라 색상 변하는 게이지 |

```css
.btn {
    transition: all 0.3s ease;
}
.btn:hover {
    transform: scale(1.1);
    background: #3498db;
}
@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
}
.loading { animation: pulse 1.5s infinite; }
```

---

### Day 3: JavaScript 기초 - 변수와 함수
**학습 목표:** JavaScript로 동적 웹 페이지 제작

| 항목 | 내용 |
|------|------|
| 이론 | 변수, 함수, 이벤트 리스너 |
| 실습 | 버튼 클릭시 텍스트 변경 |
| 과제 | 클릭 카운터 만들기 |

```javascript
let count = 0;
function increment() {
    count++;
    document.getElementById('counter').innerText = count;
}
```

---

### Day 4: JavaScript - DOM 조작
**학습 목표:** HTML 요소 동적 제어

| 항목 | 내용 |
|------|------|
| 이론 | getElementById, innerHTML, classList |
| 실습 | 버튼으로 LED 상태 표시 변경 |
| 과제 | 토글 스위치 UI 구현 |

```javascript
function toggleLED(color) {
    const led = document.getElementById(color + '-led');
    led.classList.toggle('on');
}
```

---

### Day 5: AJAX와 비동기 통신
**학습 목표:** 페이지 새로고침 없이 데이터 갱신

| 항목 | 내용 |
|------|------|
| 이론 | fetch API, JSON, Promise |
| 실습 | 센서 데이터 실시간 갱신 |
| 과제 | 1초마다 온습도 업데이트 |

```javascript
async function updateSensor() {
    const response = await fetch('/sensor');
    const data = await response.json();
    document.getElementById('temp').innerText = data.temperature + '°C';
    document.getElementById('humid').innerText = data.humidity + '%';
}
setInterval(updateSensor, 1000);
```

---

## Part 2: ESP32 웹 서버 고급 (Day 6-10)

### Day 6: JSON API 서버 구축
**학습 목표:** ESP32를 RESTful API 서버로 구현

| 항목 | 내용 |
|------|------|
| 이론 | REST API, JSON 형식, 엔드포인트 |
| 실습 | /api/sensor, /api/led 엔드포인트 |
| 과제 | 모든 하드웨어 상태 API |

```cpp
#include <ArduinoJson.h>

void handleSensorAPI() {
    StaticJsonDocument<200> doc;
    doc["temperature"] = temperature;
    doc["humidity"] = humidity;
    doc["timestamp"] = millis();

    String json;
    serializeJson(doc, json);
    server.send(200, "application/json", json);
}

void setup() {
    server.on("/api/sensor", handleSensorAPI);
}
```

---

### Day 7: POST 요청 처리
**학습 목표:** POST 방식으로 데이터 수신

| 항목 | 내용 |
|------|------|
| 이론 | GET vs POST, request body |
| 실습 | JSON으로 LED 제어 명령 수신 |
| 과제 | 여러 LED 동시 제어 API |

```cpp
void handleLEDControl() {
    if (server.hasArg("plain")) {
        String body = server.arg("plain");
        StaticJsonDocument<200> doc;
        deserializeJson(doc, body);

        bool red = doc["red"];
        bool yellow = doc["yellow"];
        bool blue = doc["blue"];

        digitalWrite(LED_RED, red ? HIGH : LOW);
        digitalWrite(LED_YELLOW, yellow ? HIGH : LOW);
        digitalWrite(LED_BLUE, blue ? HIGH : LOW);

        server.send(200, "application/json", "{\"status\":\"ok\"}");
    }
}
```

---

### Day 8: WebSocket 실시간 통신
**학습 목표:** 양방향 실시간 데이터 전송

| 항목 | 내용 |
|------|------|
| 이론 | WebSocket 프로토콜, 이벤트 기반 통신 |
| 실습 | 실시간 센서 데이터 푸시 |
| 과제 | 스위치 이벤트 실시간 전송 |

```cpp
#include <WebSocketsServer.h>

WebSocketsServer webSocket = WebSocketsServer(81);

void loop() {
    webSocket.loop();

    // 1초마다 센서 데이터 전송
    static unsigned long lastSend = 0;
    if (millis() - lastSend > 1000) {
        String json = "{\"temp\":" + String(temp) + ",\"humid\":" + String(humid) + "}";
        webSocket.broadcastTXT(json);
        lastSend = millis();
    }
}
```

---

### Day 9: 파일 시스템 (SPIFFS/LittleFS)
**학습 목표:** ESP32 내부에 파일 저장

| 항목 | 내용 |
|------|------|
| 이론 | 플래시 메모리, 파일 시스템 |
| 실습 | HTML/CSS/JS 파일 업로드 |
| 과제 | 설정 파일 저장/불러오기 |

```cpp
#include <LittleFS.h>

void setup() {
    LittleFS.begin();

    // 파일 서빙
    server.serveStatic("/", LittleFS, "/").setDefaultFile("index.html");
}

// 설정 저장
void saveConfig() {
    File f = LittleFS.open("/config.json", "w");
    f.print("{\"ssid\":\"" + ssid + "\",\"password\":\"" + password + "\"}");
    f.close();
}
```

---

### Day 10: OTA 업데이트
**학습 목표:** 무선으로 펌웨어 업데이트

| 항목 | 내용 |
|------|------|
| 이론 | OTA 개념, ArduinoOTA 라이브러리 |
| 실습 | Wi-Fi로 코드 업로드 |
| 과제 | 웹 페이지에서 펌웨어 업로드 |

```cpp
#include <ArduinoOTA.h>

void setup() {
    ArduinoOTA.setHostname("esp32-edu");
    ArduinoOTA.setPassword("admin");
    ArduinoOTA.begin();
}

void loop() {
    ArduinoOTA.handle();
}
```

---

## Part 3: 스마트폰 연동 (Day 11-18)

### Day 11: 모바일 웹 앱 설계
**학습 목표:** 스마트폰 친화적 UI 설계

| 항목 | 내용 |
|------|------|
| 이론 | 터치 인터페이스, 모바일 UX |
| 실습 | 큰 버튼, 터치 피드백 |
| 과제 | 스마트폰용 제어 패널 |

```html
<style>
    .control-btn {
        width: 80%;
        height: 60px;
        font-size: 24px;
        margin: 10px auto;
        border-radius: 30px;
        -webkit-tap-highlight-color: transparent;
    }
    .control-btn:active {
        transform: scale(0.95);
    }
</style>
```

---

### Day 12: 스마트폰에서 LED 제어
**학습 목표:** 모바일 웹으로 LED 원격 제어

| 항목 | 내용 |
|------|------|
| 이론 | 모바일 HTTP 요청 |
| 실습 | 큰 토글 버튼으로 LED 제어 |
| 과제 | RGB 색상 선택기로 LED 제어 |

```html
<div class="led-control">
    <button onclick="toggleLED('red')" class="btn red">빨강 LED</button>
    <button onclick="toggleLED('yellow')" class="btn yellow">노랑 LED</button>
    <button onclick="toggleLED('blue')" class="btn blue">파랑 LED</button>
</div>

<script>
async function toggleLED(color) {
    await fetch('/led/' + color + '/toggle');
    updateStatus();
}
</script>
```

---

### Day 13: 스마트폰에서 부저 제어
**학습 목표:** 모바일로 부저 소리 제어

| 항목 | 내용 |
|------|------|
| 이론 | 주파수 선택, 볼륨 제어 |
| 실습 | 피아노 건반 UI |
| 과제 | 스마트폰 피아노 앱 |

```html
<div class="piano">
    <button ontouchstart="playNote(262)" ontouchend="stopNote()">도</button>
    <button ontouchstart="playNote(294)" ontouchend="stopNote()">레</button>
    <button ontouchstart="playNote(330)" ontouchend="stopNote()">미</button>
    <!-- ... -->
</div>
```

---

### Day 14: 실시간 센서 모니터링 앱
**학습 목표:** 스마트폰에서 센서 데이터 모니터링

| 항목 | 내용 |
|------|------|
| 이론 | 실시간 그래프, 데이터 시각화 |
| 실습 | 온습도 실시간 그래프 |
| 과제 | 24시간 기록 그래프 |

```html
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<canvas id="tempChart"></canvas>

<script>
const ctx = document.getElementById('tempChart');
const chart = new Chart(ctx, {
    type: 'line',
    data: {
        labels: [],
        datasets: [{
            label: '온도 (°C)',
            data: [],
            borderColor: 'red'
        }]
    }
});

function updateChart(temp) {
    chart.data.labels.push(new Date().toLocaleTimeString());
    chart.data.datasets[0].data.push(temp);
    if (chart.data.labels.length > 20) {
        chart.data.labels.shift();
        chart.data.datasets[0].data.shift();
    }
    chart.update();
}
</script>
```

---

### Day 15: 스마트폰 알림 시스템
**학습 목표:** 조건에 따른 알림 발송

| 항목 | 내용 |
|------|------|
| 이론 | Web Notification API |
| 실습 | 온도 경고 알림 |
| 과제 | 사용자 지정 알림 조건 |

```javascript
// 알림 권한 요청
Notification.requestPermission();

function sendNotification(title, body) {
    if (Notification.permission === 'granted') {
        new Notification(title, { body: body });
    }
}

// 온도 30도 이상시 알림
if (temperature > 30) {
    sendNotification('온도 경고!', '현재 온도: ' + temperature + '°C');
}
```

---

### Day 16: 스마트폰 센서 활용 (가속도계)
**학습 목표:** 스마트폰 기울기로 ESP32 제어

| 항목 | 내용 |
|------|------|
| 이론 | DeviceOrientation API |
| 실습 | 폰 기울이면 LED 색상 변경 |
| 과제 | 폰 기울기로 서보모터 제어 (확장) |

```javascript
window.addEventListener('deviceorientation', (event) => {
    const beta = event.beta;   // 전후 기울기 (-180 ~ 180)
    const gamma = event.gamma; // 좌우 기울기 (-90 ~ 90)

    // 기울기에 따라 LED 제어
    fetch('/tilt?x=' + gamma + '&y=' + beta);
});
```

---

### Day 17: QR 코드 연결
**학습 목표:** QR 코드로 빠른 연결

| 항목 | 내용 |
|------|------|
| 이론 | QR 코드 생성 |
| 실습 | ESP32 IP 주소 QR 코드 표시 |
| 과제 | OLED에 QR 코드 표시 |

```cpp
#include <qrcode.h>

void displayQRCode() {
    QRCode qrcode;
    uint8_t qrcodeData[qrcode_getBufferSize(3)];
    String url = "http://" + WiFi.localIP().toString();

    qrcode_initText(&qrcode, qrcodeData, 3, 0, url.c_str());

    // OLED에 QR 코드 그리기
    for (int y = 0; y < qrcode.size; y++) {
        for (int x = 0; x < qrcode.size; x++) {
            if (qrcode_getModule(&qrcode, x, y)) {
                display.fillRect(x*2+10, y*2+10, 2, 2, WHITE);
            }
        }
    }
    display.display();
}
```

---

### Day 18: 종합 실습 - 스마트 리모컨
**학습 목표:** 스마트폰으로 모든 하드웨어 제어

| 항목 | 내용 |
|------|------|
| 프로젝트 | 통합 제어 앱 |
| 기능 | LED 제어, 부저 제어, 센서 모니터링 |
| 과제 | 즐겨찾기/자주 쓰는 기능 저장 |

---

## Part 4: 고급 하드웨어 제어 (Day 19-24)

### Day 19: 인터럽트와 빠른 반응
**학습 목표:** 인터럽트로 즉각적인 이벤트 처리

| 항목 | 내용 |
|------|------|
| 이론 | 하드웨어 인터럽트, ISR |
| 실습 | 버튼 인터럽트로 LED 토글 |
| 과제 | 반응속도 측정 게임 |

```cpp
volatile bool buttonPressed = false;

void IRAM_ATTR handleButtonPress() {
    buttonPressed = true;
}

void setup() {
    attachInterrupt(digitalPinToInterrupt(SWITCH_PIN), handleButtonPress, RISING);
}

void loop() {
    if (buttonPressed) {
        buttonPressed = false;
        // 버튼 처리 로직
    }
}
```

---

### Day 20: 타이머와 멀티태스킹
**학습 목표:** 여러 작업 동시 처리

| 항목 | 내용 |
|------|------|
| 이론 | millis(), 논블로킹 코드 |
| 실습 | LED 깜빡임 + 센서 읽기 동시 처리 |
| 과제 | 3가지 이상 작업 동시 처리 |

```cpp
unsigned long lastLED = 0;
unsigned long lastSensor = 0;

void loop() {
    unsigned long now = millis();

    // 500ms마다 LED 토글
    if (now - lastLED >= 500) {
        lastLED = now;
        digitalWrite(LED_RED, !digitalRead(LED_RED));
    }

    // 2000ms마다 센서 읽기
    if (now - lastSensor >= 2000) {
        lastSensor = now;
        readSensor();
    }

    server.handleClient();
}
```

---

### Day 21: EEPROM/Preferences 데이터 저장
**학습 목표:** 전원 꺼져도 데이터 유지

| 항목 | 내용 |
|------|------|
| 이론 | NVS, Preferences 라이브러리 |
| 실습 | Wi-Fi 설정 저장 |
| 과제 | 사용자 설정값 저장/복원 |

```cpp
#include <Preferences.h>
Preferences prefs;

void saveWiFiConfig(String ssid, String password) {
    prefs.begin("wifi", false);
    prefs.putString("ssid", ssid);
    prefs.putString("password", password);
    prefs.end();
}

void loadWiFiConfig() {
    prefs.begin("wifi", true);
    String ssid = prefs.getString("ssid", "");
    String password = prefs.getString("password", "");
    prefs.end();
}
```

---

### Day 22: AP 모드와 설정 페이지
**학습 목표:** 초기 Wi-Fi 설정 포털

| 항목 | 내용 |
|------|------|
| 이론 | AP 모드, Captive Portal |
| 실습 | Wi-Fi 설정 웹 페이지 |
| 과제 | 자동 연결 + 실패시 AP 모드 |

```cpp
void startAPMode() {
    WiFi.mode(WIFI_AP);
    WiFi.softAP("ESP32-Setup", "12345678");

    server.on("/", handleSetupPage);
    server.on("/save", handleSaveConfig);
    server.begin();
}

String getSetupHTML() {
    return R"(
        <form action="/save" method="POST">
            <input name="ssid" placeholder="Wi-Fi 이름">
            <input name="password" type="password" placeholder="비밀번호">
            <button type="submit">저장</button>
        </form>
    )";
}
```

---

### Day 23: 딥슬립과 저전력
**학습 목표:** 배터리 절약 모드

| 항목 | 내용 |
|------|------|
| 이론 | Deep Sleep, 웨이크업 소스 |
| 실습 | 버튼으로 깨우기, 타이머로 깨우기 |
| 과제 | 배터리 모니터링 시스템 |

```cpp
#define uS_TO_S_FACTOR 1000000

void setup() {
    // 센서 읽고 전송
    readAndSendData();

    // 60초 후 깨우기 설정
    esp_sleep_enable_timer_wakeup(60 * uS_TO_S_FACTOR);

    // 버튼으로도 깨우기 (GPIO32)
    esp_sleep_enable_ext0_wakeup(GPIO_NUM_32, 1);

    // 딥슬립 진입
    esp_deep_sleep_start();
}
```

---

### Day 24: 아날로그 입력 (ADC)
**학습 목표:** 아날로그 센서 값 읽기

| 항목 | 내용 |
|------|------|
| 이론 | ADC, 12비트 해상도, 기준 전압 |
| 실습 | 가변저항/조도센서 연결 (TP1, TP2) |
| 과제 | 밝기에 따라 LED 자동 조절 |

**사용 핀:** TP1(36), TP2(39)

```cpp
#define LIGHT_SENSOR 36

void loop() {
    int lightValue = analogRead(LIGHT_SENSOR);  // 0-4095
    int brightness = map(lightValue, 0, 4095, 0, 255);

    analogWrite(LED_RED, brightness);

    Serial.println("조도: " + String(lightValue));
    delay(100);
}
```

---

## Part 5: 종합 프로젝트 (Day 25-30)

### Day 25: 프로젝트 기획
**학습 목표:** 스마트홈 컨트롤러 설계

| 항목 | 내용 |
|------|------|
| 활동 | 요구사항 정의, UI 설계 |
| 산출물 | 기능 명세서, 화면 설계서 |

---

### Day 26: 백엔드 구현
**학습 목표:** ESP32 서버 기능 구현

| 항목 | 내용 |
|------|------|
| 실습 | API 엔드포인트 구현 |
| 기능 | 센서 API, 제어 API, 설정 API |

---

### Day 27: 프론트엔드 구현
**학습 목표:** 모바일 웹 앱 UI 구현

| 항목 | 내용 |
|------|------|
| 실습 | HTML/CSS/JS 페이지 제작 |
| 기능 | 대시보드, 제어 패널, 설정 페이지 |

---

### Day 28: 통합 및 테스트
**학습 목표:** 전체 시스템 통합

| 항목 | 내용 |
|------|------|
| 활동 | 기능 테스트, 버그 수정 |
| 테스트 | 다양한 스마트폰에서 테스트 |

---

### Day 29: 최적화 및 개선
**학습 목표:** 성능 및 UX 개선

| 항목 | 내용 |
|------|------|
| 활동 | 응답 속도 개선, UI 개선 |
| 추가 | 에러 처리, 예외 상황 대응 |

---

### Day 30: 발표 및 코드 리뷰
**학습 목표:** 프로젝트 발표

| 항목 | 내용 |
|------|------|
| 활동 | 프로젝트 발표, 시연 |
| 피드백 | 코드 리뷰, 개선점 논의 |

---

## 최종 프로젝트: 스마트홈 컨트롤러

### 기능 목록
1. **스마트폰 대시보드**
   - 온습도 실시간 모니터링
   - 24시간 그래프
   - 알림 설정

2. **원격 제어**
   - LED 개별/전체 제어
   - 부저 알림 테스트
   - 타이머 설정

3. **자동화**
   - 온도 기준 LED 자동 제어
   - 시간대별 자동 동작
   - 조건부 알림

4. **설정**
   - Wi-Fi 설정 (AP 모드)
   - 알림 임계값 설정
   - 저전력 모드 설정

---

## 핀 사용 요약 (중급)

| 기능 | GPIO | Part |
|------|------|------|
| LED_RED | 25 | 전체 |
| LED_YELLOW | 26 | 전체 |
| LED_BLUE | 27 | 전체 |
| BUZZER_BEEP | 14 | Part 3 |
| BUZZER_MELODY | 33 | Part 3 |
| SWITCH | 32 | Part 4 |
| I2C_SDA | 21 | Part 3-5 |
| I2C_SCL | 22 | Part 3-5 |
| TP1 (ADC) | 36 | Day 24 |
| TP2 (ADC) | 39 | Day 24 |
